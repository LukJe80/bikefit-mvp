<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bikefit – Logowanie</title>

  <!-- używamy stylu aplikacji, żeby było spójnie -->
  <link rel="stylesheet" href="./bikefitting/app.css" />
  <meta name="theme-color" content="#020617">
  <link rel="manifest" href="./manifest.webmanifest">

  <style>
    /* małe dopasowanie do ekranu logowania */
    body { min-height: 100vh; display:flex; align-items:center; justify-content:center; }
    .loginCard { width:min(620px, 92vw); }
    .loginRow { display:flex; gap:12px; align-items:center; }
    .loginRow input { flex:1; }
    .tip { margin-top:10px; opacity:.85; }
  </style>
</head>

<body>
  <div class="card loginCard">
    <div class="h" style="font-size:22px; margin-bottom:6px;">Bikefit LIVE</div>
    <div class="small" style="margin-bottom:14px;">
      Logowanie (PIN). Po zalogowaniu wejdziesz do aplikacji LIVE.
    </div>

    <label>PIN</label>
    <div class="loginRow">
      <input id="pin" type="password" inputmode="numeric" placeholder="Wpisz PIN..." />
      <button class="btn primary" id="loginBtn">Zaloguj</button>
      <button class="btn" id="clearBtn" title="Czyści dane sesji i logowanie">Wyczyść</button>
    </div>

    <div class="tip small">
      Tip: to prosta bramka (localStorage). Później można podpiąć Supabase/login.
    </div>

    <div id="msg" class="small" style="margin-top:10px;"></div>
  </div>

<script>
/* ========= ROOT LOGIN (bez dubli!) ========= */
(function(){
  const AUTH_KEY = "bikefit_auth";
  const SESSION_KEY = "bikefit_session_mod_v1";

  // ZMIEŃ PIN TUTAJ:
  const PIN_CODE = "1234";

  function setMsg(t){
    const el = document.getElementById("msg");
    el.textContent = t || "";
  }

  function authed(){
    try{
      const raw = localStorage.getItem(AUTH_KEY);
      if(!raw) return false;
      const obj = JSON.parse(raw);
      return obj && obj.exp && obj.exp > Date.now();
    }catch(e){ return false; }
  }

  // jeśli już zalogowany -> od razu do app
  if(authed()){
    location.replace("./bikefitting/");
    return;
  }

  function doLogin(){
    const pin = (document.getElementById("pin").value || "").trim();
    if(pin !== PIN_CODE){
      setMsg("Błędny PIN.");
      return;
    }
    // 7 dni ważności
    const exp = Date.now() + 7*24*60*60*1000;
    localStorage.setItem(AUTH_KEY, JSON.stringify({ exp }));
    location.replace("./bikefitting/");
  }

  function doClear(){
    if(!confirm("Wyczyścić logowanie + całą sesję (klient/pomiary/zmiany)?")) return;
    localStorage.removeItem(AUTH_KEY);
    localStorage.removeItem(SESSION_KEY);
    setMsg("Wyczyszczono.");
    document.getElementById("pin").value = "";
  }

  document.getElementById("loginBtn").addEventListener("click", doLogin);
  document.getElementById("clearBtn").addEventListener("click", doClear);
  document.getElementById("pin").addEventListener("keydown", (e) => {
    if(e.key === "Enter") doLogin();
  });

  setMsg("");
})();
</script>
</body>
</html>
